/**
* Wig - 0.2.0
*/
!function(a,b){"function"==typeof define&&define.amd?define(function(){return a.wig=b({})}):"object"==typeof exports?module.exports=b({}):a.wig=b({})}(this,function(a){function b(a){var b,c,d=Array.prototype.slice.call(arguments,1),e=d.length;for(c=0;e>c;c+=1)if(d[c]&&"object"==typeof d[c])for(b in d[c])a[b]=d[c][b];return a}function c(a){return(a||0)+g++}function d(a,b){return b.appendChild(a.getNode()),a.paint(),a.notifyAttach(),a}var e=a.api={getElement:function(a,b){return b?a.querySelector(b):a},getFocusedElement:function(){return document.activeElement},compile:function(b,c){return a.env.compiler.compile(b,c)}},f=a.env={},g=0,h=function(){},i="wig_view_id",j="data-"+i,k=Array.prototype.indexOf;a.DATA_ATTRIBUTE=i;var l=a.Class=function(){};l.extend=function(a,c){var d,e=this,f=Object.create(e.prototype);return d=a&&a.hasOwnProperty("constructor")?a.constructor:function(){e.apply(this,arguments)},b(f,a),b(d,c),d.extend=e.extend,d.prototype=f,d.prototype.constructor=d,d};var m=a.Compiler=l.extend({start:"{{",end:"}}",constructor:function(){this.templateCache=new p,this.regExp=new RegExp(this.start+"\\s*[\\w\\d\\.]+\\s*"+this.end,"gim")},replacer:function(a,b){var c=b[a[0]],d=a.length,e=b,f=0;if(d>1){for(;e&&d>f;)e=e[a[f++]];c=e}return c},compilerMethodFactory:function(a){var b=a.substring(this.start.length,a.length-this.end.length);return b=b.trim().split("."),this.replacer.bind(this,b)},generateCompiledResult:function(a){var b,c,d=a.match(this.regExp),e=0;if(d){for(b=a.split(this.regExp),c=[];d.length>0;)c.push(b[e],this.compilerMethodFactory(d.shift())),e+=1;c.push(b[e]),this.templateCache.set(a,c)}return this.templateCache.get(a)||a},compile:function(a,b){var c,d,e,f=this.templateCache.get(a),g="";if(f||(f=this.generateCompiledResult(a)),b&&"object"==typeof b)for(d=0,e=f.length;e>d;d++)c=f[d],g+="function"==typeof c?c(b):c;return g},getCompiled:function(a){return this.templateCache.get(a)},disposeMarkups:function(){this.templateCache.empty()}}),n=a.DOM=l.extend({initNode:function(a,c,d){var e,f=c;if(Array.isArray(c))f=c.join(" ");else if(c&&"object"==typeof c){f=[];for(e in c)c.hasOwnProperty(e)&&c[e]&&f.push(e);f=f.join(" ")}return f&&(a.className=f),d&&b(a.dataset,d),a},findClosestViewNode:function(a,b){var c;do{if(c=a.getAttribute(b),null!=c)return c;a=a.parentNode}while(a!==document)},attachNodeToParent:function(a,b,c){"number"==typeof c?b.insertBefore(a,b.children[c]):b.appendChild(a)}}),o=a.Insurer=a.Class.extend({is:{defined:function(a,b){if("undefined"!=typeof a||null===a)throw new TypeError(b||"Argument is defined (not null and not undefined)!")},object:function(a,b){if(a&&"object"!=typeof a)throw new TypeError(b||"Argument should be a function or undefined!")},callable:function(a,b){if(a&&"function"!=typeof a)throw new TypeError(b||"Argument should be a function or undefined!")},number:function(a,b){if(0!==a&&a&&"number"!=typeof a)throw new TypeError(b||"Argument should be a string or undefined!")},string:function(a,b){if(""!==a&&a&&"string"!=typeof a)throw new TypeError(b||"Argument should be a string or undefined!")}},exists:{object:function(a,b){if(null==a||"object"!=typeof a)throw new TypeError(b||"Argument must be a function!")},callable:function(a,b){if(null==a||"function"!=typeof a)throw new TypeError(b||"Argument must be a function!")},number:function(a,b){if(null==a||"number"!=typeof a)throw new TypeError(b||"Argument must be a string!")},string:function(a,b){if(null==a||"string"!=typeof a)throw new TypeError(b||"Argument must be a string!")}}}),p=a.Registry=l.extend({constructor:function(){this.root={}},get:function(a){return this.root[a]},set:function(a,b){this.root[a]=b},unset:function(a){delete this.root[a]},each:function(a,b){var c,d;if("function"==typeof a)for(c in this.root)d=this.get(c),a.call(b||this,c,d)},empty:function(){Object.keys(this.root).forEach(this.unset,this)}}),q=a.Selection=l.extend({constructor:function(a){this.DOM=a,this.id=void 0,this.path=void 0,this.start=0,this.end=0},preserveSelection:function(){var b=a.api.getFocusedElement();this.start=b.selectionStart,this.end=b.selectionEnd},getIndexOfNode:function(a,b){var c=[];do c.push(a.classList[0]||k.call(a.parentNode.children,a)),a=a.parentNode;while(a!==b);return c},preserveSelectionInView:function(b){var c,d=a.api.getFocusedElement(),e=this.DOM.findClosestViewNode(d,j),f=b.getID();if(e&&e===f){try{this.preserveSelection()}catch(g){}c=b.getNode(),this.id=f,d!==c&&(this.path=d.id||this.getIndexOfNode(d,c))}},restoreSelection:function(a){"function"==typeof a.setSelectionRange&&a.setSelectionRange(this.start,this.end)},findNodeByIndex:function(a,b){if("number"==typeof a)b=b.children[a];else if(b=b.children[0],b.classList[0]!==a)do b=b.nextSibling;while(b.classList[0]!==a);return b},restoreSelectionInView:function(a){var b,c=a.getNode(),d=this.path;if(this.id&&this.id===a.getID()){if(d&&d.length>0)do b=d.pop(),c=this.findNodeByIndex(b,c);while(0!==d.length);try{this.restoreSelection(c)}catch(e){}c.focus(),this.id=void 0,this.path=void 0}}}),r=a.UIEventProxy=l.extend({listeners:[],constructor:function(a,b){this.DOM=a,this.ViewManager=b,this.listener=this.listener.bind(this)},findFirstViewAndFireEvent:function(a,b){do{if(b.hasEvent(a))return void b.fireDOMEvent(a);b=this.ViewManager.getParentView(b)}while(b)},addListener:function(a,b){a.addEventListener(b,this.listener)},removeListener:function(a,b){a.removeEventListener(b,this.listener)},listener:function(a){var b=this.DOM.findClosestViewNode(a.target,j),c=this.ViewManager.getView(b);return c?this.findFirstViewAndFireEvent(a,c):void 0},startListenTo:function(a){this.isListeningTo(a)||(this.listeners.push(a),this.addListener(document,a))},stopListenTo:function(a){var b=this.listeners.indexOf(a);b>-1&&(this.removeListener(document,a),this.listeners.splice(b,1))},isListeningTo:function(a){return this.listeners.indexOf(a)>-1}}),s=a.ViewHelper=l.extend({constructor:function(a){l.apply(this,arguments),this.ViewManager=a},createChildView:function(b,c,d){var e=new c(d);return u.registerView(e,b),a.env.viewManager.getChildViews(b.getID()).push(e.getID()),e},initializeChildren:function(a){for(var b,c=this.ViewManager.getChildViews(a.getID()),d=c.length,e=0;d>e;)b=this.ViewManager.getView(c[e]),b.initialize(),e+=1},paintChildren:function(b){for(var c,d=a.env.viewManager.getChildViews(b.getID()),e=d.length,f=0;e>f;)c=this.ViewManager.getView(d[f]),this.ViewManager.updateView(c),f+=1},paintChildView:function(a,b){var c=a.getView(b);c&&this.ViewManager.updateView(c)}}),t=a.ViewManager=l.extend({constructor:function(a,b,c){this.DOM=b,this.Selection=c,this.ViewRegistry=a},getView:function(a){var b=this.ViewRegistry.get(a);return b&&b.view},getParent:function(a){var b=this.ViewRegistry.get(a);return b&&b.parent},getChildViews:function(a){var b=this.ViewRegistry.get(a);return b&&b.children},getParentView:function(a){var b=a.getID(),c=this.getParent(b);return this.getView(c)},getViewAtNode:function(a){return this.getView(a.dataset[i])},getRootNodeMapping:function(a,b){var c=b.getID(),d=a.getSelectorForChild(c),f=a.getNode();return e.getElement(f,d)},compileTemplate:function(a){var b=a.template,c=a.serialize();return"function"==typeof b?a.template(c):(Array.isArray(b)&&(b=b.join("")),e.compile(b,c))},updateView:function(a){var b,c=a.getNode(),d=this.getParentView(a),e=c.parentNode;a.undelegateAll(),this.Selection.preserveSelectionInView(a),d&&(e=this.getRootNodeMapping(d,a)),b=k.call(e.children,c),b>-1&&e.removeChild(c),a.paint(),this.DOM.attachNodeToParent(c,e,b),this.Selection.restoreSelectionInView(a)},notifyViewAboutAttach:function(a){var b=this.getView(a);b.notifyAttach()},notifyViewAboutDetach:function(a){var b=this.getView(a);b.notifyDetach()},removeViewFromParent:function(a){var b=this.getParentView(a),c=a.getID();b?b.removeView(c):a.destroy()},destroyViewAtNode:function(a){var b=this.getViewAtNode(a);b&&b.remove()}});a.extend=b,a.generateID=c,a.init=function(){a.env.dom=new n,a.env.insurer=new o,a.env.compiler=new m,a.env.selection=new q(a.env.dom),a.env.viewManager=new t(u.Registry,a.env.dom,a.env.selection),a.env.viewHelper=new s(a.env.viewManager),a.env.uiEventProxy=new r(a.env.dom,a.env.viewManager)},a.renderView=d;var u=a.View=l.extend({constructor:function v(a){a=a||{},this._ID=a.id||c("v"),v.registerView(this),this.css=a.css||"",this.node=a.node||document.createElement(this.tagName),this.context={},this.attached=!1,this.initializeWithContext(a)}},{Registry:new p,registerView:function(a,b){var c=a.getID();u.Registry.set(c,{contextRegistry:new p,customEvents:{},children:[],parent:b&&b.getID(),view:a})},removeView:function(a){"string"!=typeof a&&(a=a.getID()),u.Registry.get(a).contextRegistry.empty(),u.Registry.unset(a)},inheritCSS:function(a,b){return b?a+" "+b:a}});return u.extend=function(a,b){return b=b||{},b.add=u.add,a.className=u.inheritCSS(this.prototype.className,a.className),l.extend.call(this,a,b)},u.add=function(b,c){return a.env.insurer.exists.object(c,"Parent View cannot be undefined!"),c.addView(this,b)},b(u.prototype,{addView:function(c,d){var e,f,g,h,i,j=this.getID(),k=u.Registry.get(j).contextRegistry;return c&&"object"==typeof c&&(d=c,c=this.View||u),d=d||{},h=j+"."+(d.id||a.generateID("v")),e=k.get(h),f=b({},e,d),g=b(f,{id:h}),i=a.env.viewHelper.createChildView(this,c,g),this.attached&&a.env.viewHelper.paintChildView(this,h),i},getView:function(b){var c=a.env.viewManager.getChildViews(this.getID());return"number"==typeof b&&b<c.length&&(b=c[b]),-1===c.indexOf(b)&&(b=this.getID()+"."+b),a.env.viewManager.getView(b)},removeView:function(b){var c,d=this.getView(b),e=a.env.viewManager.getChildViews(this.getID());d&&(c=e.indexOf(d.getID()),c>-1&&(d.destroy(),e.splice(c,1)))}}),b(u.prototype,{_undelegateType:function(b,c){for(var d,e=b[c],f=e.length;f--;)d=this.find(e[f]),a.env.uiEventProxy.removeListener(d,c)},delegate:function(b,c){var d,e=this.getID(),f=u.Registry.get(e).customEvents;f[b]||(f[b]=[]),-1===f[b].indexOf(c)&&(d=this.find(c),a.env.uiEventProxy.addListener(d,b),f[b].push(c||""))},undelegate:function(a){var b=this.getID(),c=u.Registry.get(b).customEvents;this._undelegateType(c,a)},undelegateAll:function(){var a=this.getID(),b=u.Registry.get(a).customEvents;Object.keys(b).forEach(this._undelegateType.bind(this,b))},listenFor:function(b){a.env.uiEventProxy.startListenTo(b)},fireDOMEvent:function(a){var b=this.events[a.type];return"function"!=typeof b&&(b=this[b]),b?b.call(this,a):void 0},hasEvent:function(a){return!(!this.events||!this.events[a.type])}}),b(u.prototype,{initializeWithContext:function(a){this.cleanupContext(a),this.set(a),this.initialize()},initialize:function(){var b={},c=[this.className],d=this.getID();b[i]=d,this.css&&c.push(this.css),a.env.dom.initNode(this.getNode(),c,b),Object.keys(this.events).forEach(this.listenFor,this),a.env.viewHelper.initializeChildren(this)},cleanupContext:function(b){var c,d,e=this.props;for(delete b.id,delete b.css,delete b.node,"object"!=typeof this.props||Array.isArray(this.props)||(e=Object.keys(this.props)),d=e.length;d--;)c=e[d],a.env.insurer.is.defined(this[c],"["+c+"] is already defined on the View instance!"),this[c]=b[c],delete b[c]},updateCSSClasses:function(){var b=[this.className],c=this.getCSS();this.css&&b.push(this.css),c&&b.push(c),a.env.dom.initNode(this.getNode(),b)},getSelectorForChild:function(a){var b=this.getView(a),c=b.getID().split(".").pop();return this.renderMap[c]||this.renderMap["*"]},paint:function(){var b=this.getNode(),c=f.viewManager.compileTemplate(this);b.innerHTML=c||"",this._emptyAndPreserveChildContext(),this.updateCSSClasses(),this.render(),a.env.viewHelper.paintChildren(this)},notifyAttach:function(){this.attached=!0,this.onAttach(),a.env.viewManager.getChildViews(this.getID()).forEach(a.env.viewManager.notifyViewAboutAttach,a.env.viewManager)},notifyDetach:function(){this.attached=!1,this.onDetach(),a.env.viewManager.getChildViews(this.getID()).forEach(a.env.viewManager.notifyViewAboutDetach,a.env.viewManager)},destroy:function(){var b=this.node.parentNode;this.undelegateAll(),this.notifyDetach(),b&&b.removeChild(this.node),a.env.viewManager.getChildViews(this.getID()).forEach(this.removeView,this),this.node.innerHTML="",this.node=null,u.removeView(this)},_serializeAndRemoveView:function(a){var b=this.getView(a),c=b.serialize();u.Registry.get(this.getID()).contextRegistry.set(a,c),this.removeView(a)},_emptyAndPreserveChildContext:function(){var b=this.getID(),c=a.env.viewManager.getChildViews(b);for(u.Registry.get(b).contextRegistry.empty();c.length>0;)this._serializeAndRemoveView(c[0])}}),b(u.prototype,{getCSS:function(){return""},getContext:function(){return this.context},parseContext:function(a){return a},serialize:function(){return b({},this.defaults,this.context)},onAttach:h,onDetach:h,render:h}),b(u.prototype,{tagName:"div",className:"View",defaults:{},renderMap:{},events:{},View:u,props:{},template:""}),b(u.prototype,{get:function(a){return this.context[a]||this.defaults[a]},getID:function(){return this._ID},getNode:function(){return this.node},set:function(a){var c;a&&"object"==typeof a&&(c=b({},this.defaults,this.context,a),b(this.context,this.parseContext(c)||c))},setNode:function(a){a&&(this.node=a,this.initialize())},find:function(a){var b=this.getNode();return a?e.getElement(b,a):b},update:function(b){this.notifyDetach(),this.set(b),a.env.viewManager.updateView(this),this.notifyAttach()},invoke:function(a){var b=Array.prototype.slice.call(arguments,1);"function"==typeof this[a]&&this[a].apply(null,b)},empty:function(){a.env.viewManager.getChildViews(this.getID()).forEach(this.removeView,this)},remove:function(){a.env.viewManager.removeViewFromParent(this)}}),a.init(),a});