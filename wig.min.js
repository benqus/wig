/**
* wigjs - 0.2.1
*/
!function(a,b){"function"==typeof define&&define.amd?define(function(){return a.wig=b({})}):"object"==typeof exports?module.exports=b({}):a.wig=b({})}(this,function(a){function b(a){var b,c,d=Array.prototype.slice.call(arguments,1),e=d.length;for(c=0;e>c;c+=1)if(d[c]&&"object"==typeof d[c])for(b in d[c])a[b]=d[c][b];return a}function c(a,b){return b.appendChild(a.getNode()),x.ViewHelper.paint(a),x.ViewHelper.notifyAttach(a),a}var d=0,e=function(){},f="wig_view_id",g="data-"+f,h=Array.prototype.indexOf,i=a.Class=function(){};i.extend=function(a,c){var d,e=this,f=Object.create(e.prototype);return d=a&&a.hasOwnProperty("constructor")?a.constructor:function(){e.apply(this,arguments)},b(f,a),b(d,c),d.extend=e.extend,d.prototype=f,d.prototype.constructor=d,d};var j=a.api={};j.compile=function(a,b){return x.Compiler.compile(a,b)},j.getElement=function(a,b){return b?a.querySelector(b):a},j.getElements=function(a,b){return b?a.querySelectorAll(b):a},j.getFocusedElement=function(){return document.activeElement};var k=a.module={},l=k.Compiler=i.extend({start:"{{",end:"}}",constructor:function(){this.templateCache=new p,this.regExp=new RegExp(this.start+"\\s*[\\w\\d\\.]+\\s*"+this.end,"gim")},replacer:function(a,b){var c=b[a[0]],d=a.length,e=b,f=0;if(d>1){for(;e&&d>f;)e=e[a[f++]];c=e}return c},compilerMethodFactory:function(a){var b=a.substring(this.start.length,a.length-this.end.length);return b=b.trim().split("."),this.replacer.bind(this,b)},generateCompiledResult:function(a){var b,c,d=a.match(this.regExp),e=0;if(d){for(b=a.split(this.regExp),c=[];d.length>0;)c.push(b[e],this.compilerMethodFactory(d.shift())),e+=1;c.push(b[e]),this.templateCache.set(a,c)}return this.templateCache.get(a)||a},compile:function(a,b){var c,d,e,f=this.templateCache.get(a),g="";if(f||(f=this.generateCompiledResult(a)),b&&"object"==typeof b)for(d=0,e=f.length;e>d;d++)c=f[d],g+="function"==typeof c?c(b):c;return g},getCompiled:function(a){return this.templateCache.get(a)},disposeMarkups:function(){this.templateCache.empty()}}),m=k.DOM=i.extend({initNode:function(a,c,d,e){var f,g=c;if(b(a,d),b(a.dataset,e),Array.isArray(c))g=c.join(" ");else if(c&&"object"==typeof c){g=[];for(f in c)c.hasOwnProperty(f)&&c[f]&&g.push(f);g=g.join(" ")}return g&&(a.className=g),a},findClosestViewNode:function(a,b){var c;do{if(c=a.getAttribute(b),null!=c)return c;a=a.parentNode}while(a!==document)},attachNodeToParent:function(a,b,c){"number"==typeof c?b.insertBefore(a,b.children[c]):b.appendChild(a)}}),n=a.module.Environment=i.extend({DATA_ATTRIBUTE:f,constructor:function(){this.Dom=new m,this.Insurer=new o,this.Compiler=new l,this.Selection=new s(this.Dom),this.ViewHelper=new u,this.ViewRegistry=new q,this.ViewManager=new v(this.ViewHelper,this.ViewRegistry,this.Dom,this.Selection),this.UIEventProxy=new t(this.ViewHelper,this.Dom,this.ViewRegistry),this.initialize()},initialize:function(){this.ViewHelper.setEnv(this.ViewManager,this.ViewRegistry,this.UIEventProxy,this.Dom,this.Insurer)},generateID:function(a){return(a||0)+d++}}),o=k.Insurer=a.Class.extend({is:{notDefined:function(a,b){if("undefined"==typeof a||null===a)throw new TypeError(b||"Argument is not defined!")},defined:function(a,b){if("undefined"!=typeof a||null===a)throw new TypeError(b||"Argument is defined (not null and not undefined)!")}},exists:{object:function(a,b){if(null==a||"object"!=typeof a)throw new TypeError(b||"Argument must be a function!")}}}),p=k.Registry=i.extend({constructor:function(){this.root={}},get:function(a){return this.root[a]},set:function(a,b){this.root[a]=b},unset:function(a){delete this.root[a]},each:function(a,b){var c,d;if("function"==typeof a)for(c in this.root)d=this.get(c),a.call(b||this,c,d)},empty:function(){Object.keys(this.root).forEach(this.unset,this)}}),q=k.ViewRegistry=p.extend({getView:function(a){var b=this.get(a);return b&&b.view},getParentID:function(a){var b=this.get(a);return b&&b.parent},getChildViews:function(a){var b=this.get(a);return b&&b.children},getParent:function(a){var b=this.get(a);return b&&b.parent},getParentView:function(a){var b=a.getID(),c=this.getParent(b);return this.getView(c)},registerView:function(a,b){var c=a.getID(),d=new r(a,b);this.set(c,d)},removeView:function(a){"string"!=typeof a&&(a=a.getID()),this.get(a).contextRegistry.empty(),this.unset(a)},getCustomEventsForView:function(a){return this.get(a).getCustomEvents()},getContextRegistryForView:function(a){return this.get(a).getContextRegistry()},setContextForChildView:function(a,b,c){this.getContextRegistryForView(a).set(b,c)},emptyViewContextRegistry:function(a){this.getContextRegistryForView(a).empty()}}),r=k.ViewRegistryItem=i.extend({constructor:function(a,b){this.view=a,this.parent=b&&b.getID(),this.children=[],this.customEvents={},this.contextRegistry=new p},getCustomEvents:function(){return this.customEvents},getContextRegistry:function(){return this.contextRegistry}}),s=k.Selection=i.extend({constructor:function(a){this.DOM=a,this.id=void 0,this.path=void 0,this.start=0,this.end=0},preserveSelection:function(){var a=j.getFocusedElement();this.start=a.selectionStart,this.end=a.selectionEnd},getIndexOfNode:function(a,b){var c=[];do c.push(a.classList[0]||h.call(a.parentNode.children,a)),a=a.parentNode;while(a!==b);return c},preserveSelectionInView:function(a){var b,c=j.getFocusedElement(),d=this.DOM.findClosestViewNode(c,g),e=a.getID();if(d&&d===e){try{this.preserveSelection()}catch(f){}b=a.getNode(),this.id=e,c!==b&&(this.path=c.id||this.getIndexOfNode(c,b))}},restoreSelection:function(a){"function"==typeof a.setSelectionRange&&a.setSelectionRange(this.start,this.end)},findNodeByIndex:function(a,b){if("number"==typeof a)b=b.children[a];else if(b=b.children[0],b.classList[0]!==a)do b=b.nextSibling;while(b.classList[0]!==a);return b},restoreSelectionInView:function(a){var b,c=a.getNode(),d=this.path;if(this.id&&this.id===a.getID()){if(d&&d.length>0)do b=d.pop(),c=this.findNodeByIndex(b,c);while(0!==d.length);try{this.restoreSelection(c)}catch(e){}c.focus(),this.id=void 0,this.path=void 0}}}),t=k.UIEventProxy=i.extend({listeners:[],constructor:function(a,b,c){this.DOM=b,this.ViewHelper=a,this.ViewRegistry=c,this.listener=this.listener.bind(this)},findFirstViewAndFireEvent:function(a,b){do{if(this.ViewHelper.hasEvent(b,a))return void this.ViewHelper.fireDOMEvent(b,a);b=this.ViewRegistry.getParentView(b)}while(b)},addListener:function(a,b){a.addEventListener(b,this.listener)},removeListener:function(a,b){a.removeEventListener(b,this.listener)},listener:function(a){var b=this.DOM.findClosestViewNode(a.target,g),c=this.ViewRegistry.getView(b);return c?this.findFirstViewAndFireEvent(a,c):void 0},startListenTo:function(a){this.isListeningTo(a)||(this.listeners.push(a),this.addListener(document,a))},stopListenTo:function(a){var b=this.listeners.indexOf(a);b>-1&&(this.removeListener(document,a),this.listeners.splice(b,1))},isListeningTo:function(a){return this.listeners.indexOf(a)>-1}}),u=k.ViewHelper=i.extend({constructor:function(){this.DOM=void 0,this.Insurer=void 0,this.ViewManager=void 0,this.UIEventProxy=void 0},setEnv:function(a,b,c,d,e){this.DOM=d,this.Insurer=e,this.ViewManager=a,this.ViewRegistry=b,this.UIEventProxy=c},createChildView:function(a,b,c){var d=new b(c);return this.ViewManager.registerChildForView(a,d),d},initializeChildren:function(a){for(var b,c=this.ViewRegistry.getChildViews(a.getID()),d=c.length,e=0;d>e;)b=this.ViewRegistry.getView(c[e]),b.initialize(),e+=1},paint:function(a){var b=a.getNode(),c=this.ViewManager.compileTemplate(a);b.innerHTML=c||"",this._emptyAndPreserveChildContext(a),a.render(),this.updateCSSClasses(a),this.paintChildren(a)},paintChildren:function(a){for(var b,c=this.ViewRegistry.getChildViews(a.getID()),d=c.length,e=0;d>e;)b=this.ViewRegistry.getView(c[e]),this.ViewManager.updateView(b),e+=1},paintChildView:function(a,b){var c=a.getView(b);c&&this.ViewManager.updateView(c)},updateCSSClasses:function(a){var b=[a.className],c=a.getCSS();a.css&&b.push(a.css),c&&b.push(c),this.DOM.initNode(a.getNode(),b)},destroy:function(a){var b=a.getNode(),c=b.parentNode;this.undelegateAll(a),this.notifyDetach(a),c&&c.removeChild(b),this.ViewManager.emptyView(a),b.innerHTML="",a.node=null},notifyAttach:function(a){var b=this.ViewManager;a.attached=!0,a.onAttach(),this.ViewRegistry.getChildViews(a.getID()).forEach(b.notifyViewAboutAttach,b)},notifyDetach:function(a){var b=this.ViewManager;a.attached=!1,a.onDetach(),this.ViewRegistry.getChildViews(a.getID()).forEach(b.notifyViewAboutDetach,b)},cleanupContext:function(a,b){if(b){var c,d,e=a.expects,f=Object.getPrototypeOf(a);for(delete b.id,delete b.css,delete b.node,"object"!=typeof e||Array.isArray(e)||(e=Object.keys(e)),d=e.length;d--;)c=e[d],this.Insurer.is.defined(f[c],"["+c+"] is already defined on the View instance!"),a[c]=b[c],delete b[c]}},_serializeAndRemoveView:function(a,b){this.ViewManager.serializeChildForView(a,b),a.removeView(b)},_emptyAndPreserveChildContext:function(a){var b=a.getID(),c=this.ViewRegistry.getChildViews(b);for(this.ViewManager.emptyContextRegistryForView(b);c.length>0;)this._serializeAndRemoveView(a,c[0])},getSelectorForChild:function(a,b){var c=a.getView(b),d=c.getID().split(".").pop();return a.renderMap[d]||a.renderMap["*"]},initializeWithContext:function(a,b){a.set(b),this.initialize(a)},initialize:function(a){var b={},c=[a.className],d=a.getAttributes();b[f]=a.getID(),a.css&&c.push(a.css),this.DOM.initNode(a.getNode(),c,d,b),Object.keys(a.events).forEach(a.listenFor,a),this.initializeChildren(a)},serialize:function(a){return b({},a.defaults,a.context)},fireDOMEvent:function(a,b){var c=a.events[b.type];return"function"!=typeof c&&(c=a[c]),c?c.call(a,b):void 0},hasEvent:function(a,b){return!(!a.events||!a.events[b.type])},undelegateType:function(a,b){for(var c,d=a.getID(),e=this.ViewManager.getCustomEventsForView(d),f=e[b],g=f.length;g--;)c=a.find(f[g]),this.UIEventProxy.removeListener(c,b)},undelegateAll:function(a){var b=a.getID(),c=this.ViewManager.getCustomEventsForView(b);Object.keys(c).forEach(this.undelegateType.bind(this,a))}}),v=k.ViewManager=i.extend({constructor:function(a,b,c,d){this.DOM=c,this.Selection=d,this.ViewHelper=a,this.ViewRegistry=b},getViewAtNode:function(a){return this.ViewRegistry.getView(a.dataset[f])},getRootNodeMapping:function(a,b){var c=b.getID(),d=this.ViewHelper.getSelectorForChild(a,c),e=a.getNode();return j.getElement(e,d)},compileTemplate:function(a){var b=a.template,c=this.ViewHelper.serialize(a);return"function"==typeof b?a.template(c):(Array.isArray(b)&&(b=b.join("")),j.compile(b,c))},updateView:function(a){var b,c=a.getNode(),d=this.ViewRegistry.getParentView(a),e=c.parentNode;this.ViewHelper.undelegateAll(a),this.Selection.preserveSelectionInView(a),d&&(e=this.getRootNodeMapping(d,a)),b=h.call(e.children,c),b>-1&&e.removeChild(c),this.ViewHelper.paint(a),this.DOM.attachNodeToParent(c,e,b),this.Selection.restoreSelectionInView(a)},notifyViewAboutAttach:function(a){var b=this.ViewRegistry.getView(a);this.ViewHelper.notifyAttach(b)},notifyViewAboutDetach:function(a){var b=this.ViewRegistry.getView(a);this.ViewHelper.notifyDetach(b)},removeViewFromParent:function(a){var b=this.ViewRegistry.getParentView(a),c=a.getID();b?b.removeView(c):this.ViewHelper.destroy(a)},destroyViewAtNode:function(a){var b=this.getViewAtNode(a);b&&b.remove()},inheritCSS:function(a,b){return b?a+" "+b:a},getCustomEventsForView:function(a){return this.ViewRegistry.getCustomEventsForView(a)},registerChildForView:function(a,b){this.ViewRegistry.registerView(b,a),this.ViewRegistry.getChildViews(a.getID()).push(b.getID())},serializeChildForView:function(a,b){var c=a.getView(b),d=this.ViewHelper.serialize(c);this.ViewRegistry.setContextForChildView(a.getID(),b,d)},emptyContextRegistryForView:function(a){this.ViewRegistry.emptyViewContextRegistry(a)},emptyView:function(a){this.ViewRegistry.getChildViews(a.getID()).forEach(a.removeView,a),this.ViewRegistry.removeView(a)}});a.extend=b,a.renderView=c,a.setup=function(a){b(j,a)};var w=a.View=i.extend({constructor:function(a){a=a||{},this._ID=a.id||x.generateID("v"),x.ViewRegistry.registerView(this),this.css=a.css||"",this.node=a.node||document.createElement(this.tagName),this.context={},this.attached=!1,x.ViewHelper.initializeWithContext(this,a)},tagName:"div",className:"View",defaults:{},renderMap:{},events:{},View:w,expects:{},template:"",get:function(a){return this.context[a]||this.defaults[a]},getID:function(){return this._ID},getNode:function(){return this.node},set:function(a){var c;x.ViewHelper.cleanupContext(this,a),a&&"object"==typeof a&&(c=b({},this.defaults,this.context,a),b(this.context,this.parseContext(c)||c))},setNode:function(a){a&&(this.node=a,this.initialize())},find:function(a){var b=this.getNode();return a?j.getElement(b,a):b},update:function(a){x.ViewHelper.notifyDetach(this),this.set(a),x.ViewManager.updateView(this),x.ViewHelper.notifyAttach(this)},empty:function(){x.ViewRegistry.getChildViews(this.getID()).forEach(this.removeView,this)},remove:function(){x.ViewManager.removeViewFromParent(this)},addView:function(a,c){var d,e,f,g,h,i=this.getID(),j=x.ViewRegistry.getContextRegistryForView(i);return a&&"object"==typeof a&&(c=a,a=this.View||w),c=c||{},g=i+"."+(c.id||x.generateID("v")),d=j.get(g),e=b({},d,c),f=b(e,{id:g}),h=x.ViewHelper.createChildView(this,a,f),this.attached&&x.ViewHelper.paintChildView(this,g),h},getView:function(a){var b=x.ViewRegistry.getChildViews(this.getID());return"number"==typeof a&&a<b.length&&(a=b[a]),-1===b.indexOf(a)&&(a=this.getID()+"."+a),x.ViewRegistry.getView(a)},removeView:function(a){var b,c=this.getView(a),d=x.ViewRegistry.getChildViews(this.getID());c&&(b=d.indexOf(c.getID()),b>-1&&(x.ViewHelper.destroy(c),d.splice(b,1)))},delegate:function(a,b){var c,d=this.getID(),e=x.ViewRegistry.getCustomEventsForView(d);e[a]||(e[a]=[]),-1===e[a].indexOf(b)&&(c=this.find(b),x.UIEventProxy.addListener(c,a),e[a].push(b||""))},listenFor:function(a){x.UIEventProxy.startListenTo(a)},getCSS:function(){return""},getAttributes:function(){return{}},parseContext:function(a){return a},onAttach:e,onDetach:e,render:e});w.extend=function(a,b){return b=b||{},b.add=w.add,a.className=x.ViewManager.inheritCSS(this.prototype.className,a.className),i.extend.call(this,a,b)},w.add=function(a,b){return x.Insurer.exists.object(b,"Parent View cannot be undefined!"),b.addView(this,a)};var x=a.env=new n;return a});