/**
* Wig - 0.2.0
*/
!function(a,b){"function"==typeof define&&define.amd?define(function(){return a.wig=b({})}):"object"==typeof exports?module.exports=b({}):a.wig=b({})}(this,function(a){function b(a){var b,c,d=Array.prototype.slice.call(arguments,1),e=d.length;for(c=0;e>c;c+=1)if(d[c]&&"object"==typeof d[c])for(b in d[c])a[b]=d[c][b];return a}function c(a){return(a||0)+g++}function d(a,b){return b.appendChild(a.getNode()),f.viewHelper.paint(a),f.viewHelper.notifyAttach(a),a}var e=a.api={getElement:function(a,b){return b?a.querySelector(b):a},getFocusedElement:function(){return document.activeElement},compile:function(a,b){return f.compiler.compile(a,b)}},f=a.env={},g=0,h=function(){},i="wig_view_id",j="data-"+i,k=Array.prototype.indexOf;a.DATA_ATTRIBUTE=i;var l=a.Class=function(){};l.extend=function(a,c){var d,e=this,f=Object.create(e.prototype);return d=a&&a.hasOwnProperty("constructor")?a.constructor:function(){e.apply(this,arguments)},b(f,a),b(d,c),d.extend=e.extend,d.prototype=f,d.prototype.constructor=d,d};var m=a.Compiler=l.extend({start:"{{",end:"}}",constructor:function(){this.templateCache=new p,this.regExp=new RegExp(this.start+"\\s*[\\w\\d\\.]+\\s*"+this.end,"gim")},replacer:function(a,b){var c=b[a[0]],d=a.length,e=b,f=0;if(d>1){for(;e&&d>f;)e=e[a[f++]];c=e}return c},compilerMethodFactory:function(a){var b=a.substring(this.start.length,a.length-this.end.length);return b=b.trim().split("."),this.replacer.bind(this,b)},generateCompiledResult:function(a){var b,c,d=a.match(this.regExp),e=0;if(d){for(b=a.split(this.regExp),c=[];d.length>0;)c.push(b[e],this.compilerMethodFactory(d.shift())),e+=1;c.push(b[e]),this.templateCache.set(a,c)}return this.templateCache.get(a)||a},compile:function(a,b){var c,d,e,f=this.templateCache.get(a),g="";if(f||(f=this.generateCompiledResult(a)),b&&"object"==typeof b)for(d=0,e=f.length;e>d;d++)c=f[d],g+="function"==typeof c?c(b):c;return g},getCompiled:function(a){return this.templateCache.get(a)},disposeMarkups:function(){this.templateCache.empty()}}),n=a.DOM=l.extend({initNode:function(a,c,d){var e,f=c;if(Array.isArray(c))f=c.join(" ");else if(c&&"object"==typeof c){f=[];for(e in c)c.hasOwnProperty(e)&&c[e]&&f.push(e);f=f.join(" ")}return f&&(a.className=f),d&&b(a.dataset,d),a},findClosestViewNode:function(a,b){var c;do{if(c=a.getAttribute(b),null!=c)return c;a=a.parentNode}while(a!==document)},attachNodeToParent:function(a,b,c){"number"==typeof c?b.insertBefore(a,b.children[c]):b.appendChild(a)}}),o=a.Insurer=a.Class.extend({is:{defined:function(a,b){if("undefined"!=typeof a||null===a)throw new TypeError(b||"Argument is defined (not null and not undefined)!")},object:function(a,b){if(a&&"object"!=typeof a)throw new TypeError(b||"Argument should be a function or undefined!")},callable:function(a,b){if(a&&"function"!=typeof a)throw new TypeError(b||"Argument should be a function or undefined!")},number:function(a,b){if(0!==a&&a&&"number"!=typeof a)throw new TypeError(b||"Argument should be a string or undefined!")},string:function(a,b){if(""!==a&&a&&"string"!=typeof a)throw new TypeError(b||"Argument should be a string or undefined!")}},exists:{object:function(a,b){if(null==a||"object"!=typeof a)throw new TypeError(b||"Argument must be a function!")},callable:function(a,b){if(null==a||"function"!=typeof a)throw new TypeError(b||"Argument must be a function!")},number:function(a,b){if(null==a||"number"!=typeof a)throw new TypeError(b||"Argument must be a string!")},string:function(a,b){if(null==a||"string"!=typeof a)throw new TypeError(b||"Argument must be a string!")}}}),p=a.Registry=l.extend({constructor:function(){this.root={}},get:function(a){return this.root[a]},set:function(a,b){this.root[a]=b},unset:function(a){delete this.root[a]},each:function(a,b){var c,d;if("function"==typeof a)for(c in this.root)d=this.get(c),a.call(b||this,c,d)},empty:function(){Object.keys(this.root).forEach(this.unset,this)}}),q=a.Selection=l.extend({constructor:function(a){this.DOM=a,this.id=void 0,this.path=void 0,this.start=0,this.end=0},preserveSelection:function(){var b=a.api.getFocusedElement();this.start=b.selectionStart,this.end=b.selectionEnd},getIndexOfNode:function(a,b){var c=[];do c.push(a.classList[0]||k.call(a.parentNode.children,a)),a=a.parentNode;while(a!==b);return c},preserveSelectionInView:function(b){var c,d=a.api.getFocusedElement(),e=this.DOM.findClosestViewNode(d,j),f=b.getID();if(e&&e===f){try{this.preserveSelection()}catch(g){}c=b.getNode(),this.id=f,d!==c&&(this.path=d.id||this.getIndexOfNode(d,c))}},restoreSelection:function(a){"function"==typeof a.setSelectionRange&&a.setSelectionRange(this.start,this.end)},findNodeByIndex:function(a,b){if("number"==typeof a)b=b.children[a];else if(b=b.children[0],b.classList[0]!==a)do b=b.nextSibling;while(b.classList[0]!==a);return b},restoreSelectionInView:function(a){var b,c=a.getNode(),d=this.path;if(this.id&&this.id===a.getID()){if(d&&d.length>0)do b=d.pop(),c=this.findNodeByIndex(b,c);while(0!==d.length);try{this.restoreSelection(c)}catch(e){}c.focus(),this.id=void 0,this.path=void 0}}}),r=a.UIEventProxy=l.extend({listeners:[],constructor:function(a,b){this.DOM=a,this.ViewManager=b,this.listener=this.listener.bind(this)},findFirstViewAndFireEvent:function(a,b){do{if(b.hasEvent(a))return void b.fireDOMEvent(a);b=this.ViewManager.getParentView(b)}while(b)},addListener:function(a,b){a.addEventListener(b,this.listener)},removeListener:function(a,b){a.removeEventListener(b,this.listener)},listener:function(a){var b=this.DOM.findClosestViewNode(a.target,j),c=this.ViewManager.getView(b);return c?this.findFirstViewAndFireEvent(a,c):void 0},startListenTo:function(a){this.isListeningTo(a)||(this.listeners.push(a),this.addListener(document,a))},stopListenTo:function(a){var b=this.listeners.indexOf(a);b>-1&&(this.removeListener(document,a),this.listeners.splice(b,1))},isListeningTo:function(a){return this.listeners.indexOf(a)>-1}}),s=a.ViewHelper=l.extend({constructor:function(a){l.apply(this,arguments),this.ViewManager=a},createChildView:function(a,b,c){var d=new b(c);return u.registerView(d,a),this.ViewManager.getChildViews(a.getID()).push(d.getID()),d},initializeChildren:function(a){for(var b,c=this.ViewManager.getChildViews(a.getID()),d=c.length,e=0;d>e;)b=this.ViewManager.getView(c[e]),b.initialize(),e+=1},paint:function(a){var b=a.getNode(),c=f.viewManager.compileTemplate(a);b.innerHTML=c||"",this._emptyAndPreserveChildContext(a),a.render(),this.updateCSSClasses(a),this.paintChildren(a)},paintChildren:function(a){for(var b,c=this.ViewManager.getChildViews(a.getID()),d=c.length,e=0;d>e;)b=this.ViewManager.getView(c[e]),this.ViewManager.updateView(b),e+=1},paintChildView:function(a,b){var c=a.getView(b);c&&this.ViewManager.updateView(c)},updateCSSClasses:function(a){var b=[a.className],c=a.getCSS();a.css&&b.push(a.css),c&&b.push(c),f.dom.initNode(a.getNode(),b)},destroy:function(a){var b=a.getNode(),c=b.parentNode;a.undelegateAll(),this.notifyDetach(a),c&&c.removeChild(b),this.ViewManager.getChildViews(a.getID()).forEach(a.removeView,a),b.innerHTML="",a.node=null,u.removeView(a)},notifyAttach:function(a){var b=this.ViewManager;a.attached=!0,a.onAttach(),b.getChildViews(a.getID()).forEach(b.notifyViewAboutAttach,b)},notifyDetach:function(a){var b=this.ViewManager;a.attached=!1,a.onDetach(),b.getChildViews(a.getID()).forEach(b.notifyViewAboutDetach,b)},cleanupContext:function(a,b){var c,d,e=a.props;for(delete b.id,delete b.css,delete b.node,"object"!=typeof a.props||Array.isArray(a.props)||(e=Object.keys(a.props)),d=e.length;d--;)c=e[d],f.insurer.is.defined(a[c],"["+c+"] is already defined on the View instance!"),a[c]=b[c],delete b[c]},_serializeAndRemoveView:function(a,b){var c=a.getView(b),d=c.serialize();u.Registry.get(a.getID()).contextRegistry.set(b,d),a.removeView(b)},_emptyAndPreserveChildContext:function(a){var b=a.getID(),c=f.viewManager.getChildViews(b);for(u.Registry.get(b).contextRegistry.empty();c.length>0;)this._serializeAndRemoveView(a,c[0])},getSelectorForChild:function(a,b){var c=a.getView(b),d=c.getID().split(".").pop();return a.renderMap[d]||a.renderMap["*"]},initializeWithContext:function(a,b){this.cleanupContext(a,b),a.set(b),this.initialize(a)},initialize:function(a){var b={},c=[a.className];b[i]=a.getID(),a.css&&c.push(a.css),f.dom.initNode(a.getNode(),c,b),Object.keys(a.events).forEach(a.listenFor,a),f.viewHelper.initializeChildren(a)}}),t=a.ViewManager=l.extend({constructor:function(a,b,c){this.DOM=b,this.Selection=c,this.ViewRegistry=a},getView:function(a){var b=this.ViewRegistry.get(a);return b&&b.view},getParent:function(a){var b=this.ViewRegistry.get(a);return b&&b.parent},getChildViews:function(a){var b=this.ViewRegistry.get(a);return b&&b.children},getParentView:function(a){var b=a.getID(),c=this.getParent(b);return this.getView(c)},getViewAtNode:function(a){return this.getView(a.dataset[i])},getRootNodeMapping:function(a,b){var c=b.getID(),d=f.viewHelper.getSelectorForChild(a,c),g=a.getNode();return e.getElement(g,d)},compileTemplate:function(a){var b=a.template,c=a.serialize();return"function"==typeof b?a.template(c):(Array.isArray(b)&&(b=b.join("")),e.compile(b,c))},updateView:function(a){var b,c=a.getNode(),d=this.getParentView(a),e=c.parentNode;a.undelegateAll(),this.Selection.preserveSelectionInView(a),d&&(e=this.getRootNodeMapping(d,a)),b=k.call(e.children,c),b>-1&&e.removeChild(c),f.viewHelper.paint(a),this.DOM.attachNodeToParent(c,e,b),this.Selection.restoreSelectionInView(a)},notifyViewAboutAttach:function(a){var b=this.getView(a);f.viewHelper.notifyAttach(b)},notifyViewAboutDetach:function(a){var b=this.getView(a);f.viewHelper.notifyDetach(b)},removeViewFromParent:function(a){var b=this.getParentView(a),c=a.getID();b?b.removeView(c):f.viewHelper.destroy(a)},destroyViewAtNode:function(a){var b=this.getViewAtNode(a);b&&b.remove()}});a.extend=b,a.generateID=c,a.init=function(){f.dom=new n,f.insurer=new o,f.compiler=new m,f.selection=new q(f.dom),f.viewManager=new t(u.Registry,f.dom,f.selection),f.viewHelper=new s(f.viewManager),f.uiEventProxy=new r(f.dom,f.viewManager)},a.renderView=d;var u=a.View=l.extend({constructor:function v(a){a=a||{},this._ID=a.id||c("v"),v.registerView(this),this.css=a.css||"",this.node=a.node||document.createElement(this.tagName),this.context={},this.attached=!1,f.viewHelper.initializeWithContext(this,a)}},{Registry:new p,registerView:function(a,b){var c=a.getID();u.Registry.set(c,{contextRegistry:new p,customEvents:{},children:[],parent:b&&b.getID(),view:a})},removeView:function(a){"string"!=typeof a&&(a=a.getID()),u.Registry.get(a).contextRegistry.empty(),u.Registry.unset(a)},inheritCSS:function(a,b){return b?a+" "+b:a}});return u.extend=function(a,b){return b=b||{},b.add=u.add,a.className=u.inheritCSS(this.prototype.className,a.className),l.extend.call(this,a,b)},u.add=function(a,b){return f.insurer.exists.object(b,"Parent View cannot be undefined!"),b.addView(this,a)},b(u.prototype,{_undelegateType:function(a,b){for(var c,d=a[b],e=d.length;e--;)c=this.find(d[e]),f.uiEventProxy.removeListener(c,b)},delegate:function(a,b){var c,d=this.getID(),e=u.Registry.get(d).customEvents;e[a]||(e[a]=[]),-1===e[a].indexOf(b)&&(c=this.find(b),f.uiEventProxy.addListener(c,a),e[a].push(b||""))},undelegate:function(a){var b=this.getID(),c=u.Registry.get(b).customEvents;this._undelegateType(c,a)},undelegateAll:function(){var a=this.getID(),b=u.Registry.get(a).customEvents;Object.keys(b).forEach(this._undelegateType.bind(this,b))},listenFor:function(a){f.uiEventProxy.startListenTo(a)},fireDOMEvent:function(a){var b=this.events[a.type];return"function"!=typeof b&&(b=this[b]),b?b.call(this,a):void 0},hasEvent:function(a){return!(!this.events||!this.events[a.type])}}),b(u.prototype,{tagName:"div",className:"View",defaults:{},renderMap:{},events:{},View:u,props:{},template:"",get:function(a){return this.context[a]||this.defaults[a]},getID:function(){return this._ID},getNode:function(){return this.node},set:function(a){var c;a&&"object"==typeof a&&(c=b({},this.defaults,this.context,a),b(this.context,this.parseContext(c)||c))},setNode:function(a){a&&(this.node=a,this.initialize())},find:function(a){var b=this.getNode();return a?e.getElement(b,a):b},update:function(a){f.viewHelper.notifyDetach(this),this.set(a),f.viewManager.updateView(this),f.viewHelper.notifyAttach(this)},empty:function(){f.viewManager.getChildViews(this.getID()).forEach(this.removeView,this)},remove:function(){f.viewManager.removeViewFromParent(this)},addView:function(c,d){var e,g,h,i,j,k=this.getID(),l=u.Registry.get(k).contextRegistry;return c&&"object"==typeof c&&(d=c,c=this.View||u),d=d||{},i=k+"."+(d.id||a.generateID("v")),e=l.get(i),g=b({},e,d),h=b(g,{id:i}),j=f.viewHelper.createChildView(this,c,h),this.attached&&f.viewHelper.paintChildView(this,i),j},getView:function(a){var b=f.viewManager.getChildViews(this.getID());return"number"==typeof a&&a<b.length&&(a=b[a]),-1===b.indexOf(a)&&(a=this.getID()+"."+a),f.viewManager.getView(a)},removeView:function(a){var b,c=this.getView(a),d=f.viewManager.getChildViews(this.getID());c&&(b=d.indexOf(c.getID()),b>-1&&(f.viewHelper.destroy(c),d.splice(b,1)))},getCSS:function(){return""},getContext:function(){return this.context},parseContext:function(a){return a},serialize:function(){return b({},this.defaults,this.context)},onAttach:h,onDetach:h,render:h}),a.init(),a});